"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,o=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(t.push(s.value),!r||t.length!==r);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var axios=require("axios"),pool=require("../utils/db"),cron=require("node-cron"),crypto=require("crypto");function getAutobotCount(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(pool.query("SELECT COUNT(*) AS count FROM Autobots"));case 3:return r=e.sent,t=_slicedToArray(r,1),n=t[0],e.abrupt("return",n[0].count);case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error getting Autobot count:",e.t0),e.t0;case 13:case"end":return e.stop()}},null,null,[[0,9]])}function createAutobot(){var r,t,n,o,a,s,c,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.get("https://jsonplaceholder.typicode.com/users"));case 3:return r=e.sent,t=r.data,n=t[Math.floor(Math.random()*t.length)],o=n.email+"."+crypto.randomBytes(4).toString("hex"),a=n.username+"_"+crypto.randomBytes(4).toString("hex"),e.next=10,regeneratorRuntime.awrap(pool.query("INSERT INTO Autobots (name, email, username) VALUES (?, ?, ?)",[n.name,o,a]));case 10:return s=e.sent,c=_slicedToArray(s,1),u=c[0],i=u.insertId,e.next=16,regeneratorRuntime.awrap(createPostsForAutobot(i));case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error creating Autobot:",e.t0);case 21:case"end":return e.stop()}},null,null,[[0,18]])}function createPostsForAutobot(r){var t,n,o,a,s,c,u,i,l,p,m,b,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.get("https://jsonplaceholder.typicode.com/posts"));case 3:t=e.sent,n=t.data,a=!(o=!0),s=void 0,e.prev=8,c=n[Symbol.iterator]();case 10:if(o=(u=c.next()).done){e.next=24;break}return i=u.value,l=i.title+"_"+crypto.randomBytes(4).toString("hex"),e.next=15,regeneratorRuntime.awrap(pool.query("INSERT INTO Posts (autobot_id, title, body) VALUES (?, ?, ?)",[r,l,i.body]));case 15:return p=e.sent,m=_slicedToArray(p,1),b=m[0],d=b.insertId,e.next=21,regeneratorRuntime.awrap(createCommentsForPost(d));case 21:o=!0,e.next=10;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(8),a=!0,s=e.t0;case 30:e.prev=30,e.prev=31,o||null==c.return||c.return();case 33:if(e.prev=33,a)throw s;e.next=36;break;case 36:return e.finish(33);case 37:return e.finish(30);case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(0),console.error("Error creating posts:",e.t1);case 43:case"end":return e.stop()}},null,null,[[0,40],[8,26,30,38],[31,,33,37]])}function createCommentsForPost(r){var t,n,o,a,s,c,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.get("https://jsonplaceholder.typicode.com/comments"));case 3:t=e.sent,n=t.data,a=!(o=!0),s=void 0,e.prev=8,c=n[Symbol.iterator]();case 10:if(o=(u=c.next()).done){e.next=17;break}return i=u.value,e.next=14,regeneratorRuntime.awrap(pool.query("INSERT INTO Comments (post_id, name, email, body) VALUES (?, ?, ?, ?)",[r,i.name,i.email,i.body]));case 14:o=!0,e.next=10;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(8),a=!0,s=e.t0;case 23:e.prev=23,e.prev=24,o||null==c.return||c.return();case 26:if(e.prev=26,a)throw s;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(0),console.error("Error creating comments:",e.t1);case 36:case"end":return e.stop()}},null,null,[[0,33],[8,19,23,31],[24,,26,30]])}cron.schedule("0 * * * *",function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0;case 2:if(r<500)return e.next=5,regeneratorRuntime.awrap(createAutobot());e.next=8;break;case 5:r++,e.next=2;break;case 8:console.log("500 Autobots created successfully!"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error in scheduled task:",e.t0);case 14:case"end":return e.stop()}},null,null,[[0,11]])}),module.exports={getAutobotCount:getAutobotCount};
//# sourceMappingURL=autobotService.min.js.map
